{{ if (.Params.comments) | or (and (or (not (isset .Params "comments")) (eq .Params.comments nil)) (.Site.Params.comments)) }}
  {{ if .Site.DisqusShortname }}
    <div class="comments">

        {{ if (.Params.comments) | or (and (or (not (isset .Params "comments")) (eq .Params.comments nil)) (.Site.Params.comments)) }}
        {{ if .Site.DisqusShortname }}
        <div class="comments">
            {{ if .Site.DisqusShortname }}
            <div id="disqus_thread"></div>
            <script type="application/javascript">

                var disqus_shortname = {{ .Site.DisqusShortname }}
                var disqus_identifier = {{ .RelPermalink }}
                var disqus_url = {{ .Permalink }}
                var disqus_title = {{ .Title }}

                var disqus_config = function() {
                    this.page = this.page || {};
                    this.page.identifier = disqus_identifier;
                    this.page.url = disqus_url;
                    this.page.title = disqus_title;
                };

                var reset = function() {
                        console.log("resetting disqus");
                        DISQUS.reset({
                        reload: true,
                        config: disqus_config
                    });
                }

                (function () {
                    
                    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
                        document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
                        return;
                    }

                    var d = document, s = d.createElement('script'); s.async = true;
                    s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';

                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s)

                    document.addEventListener("load", reset, false);

                }) ();

            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            {{end}}
        </div>
        {{ end }}
        {{ end }}

    </div>
  {{ end }}
{{ end }}